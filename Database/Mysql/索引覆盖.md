# 索引覆盖

## 回表查询

这先要从InnoDB的索引实现说起，InnoDB有两大类索引：

- 聚集索引(clustered index)
- 普通索引(secondary index)

## **InnoDB聚集索引和普通索引有什么差异？**

InnoDB**聚集索引**的叶子节点存储行记录，因此， InnoDB必须要有，且只有一个聚集索引：

（1）如果表定义了PK，则PK就是聚集索引

（2）如果表没有定义PK，则第一个not NULL unique列是聚集索引

（3）否则，InnoDB会创建一个隐藏的row-id作为聚集索引

*画外音：所以PK查询非常快，直接定位行记录*

InnoDB普通索引的叶子节点存储主键值

*画外音：注意，不是存储行记录头指针，MyISAM的索引叶子节点存储记录指针*

![img](img\885859-20190729184808306-758660222.png)

两个B+树索引分别如上图：

　　（1）id为PK，聚集索引，叶子节点存储行记录

　　（2）name为KEY，普通索引，叶子节点存储PK值，即id

![img](img\885859-20190729184911699-676257427.png)

普通索引需要扫码两遍索引树：

（1）先通过普通索引定位到主键值id=5

（2）在通过聚集索引定位到行记录

这就是所谓的**回表查询**，先定位主键值，再定位行记录，它的性能较扫一遍索引树更低

## 索引覆盖

只需要在一棵索引树上就能获取SQL所需的所有列数据，无需回表，速度更快，常见的方法是将查询的字段，建立到联合索引里面